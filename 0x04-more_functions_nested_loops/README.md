More functions and nested lopps
